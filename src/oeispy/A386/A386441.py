# This file is auto-generated from OEIS data.
# Please do not edit this file directly.
# OEIS sequence: A386441

from math import isqrt, comb
from sympy import multiplicity
from gmpy2 import digits
def A386441(n):
    def g1(s,w,e):
        c, d = 1, 0
        if len(s) == 0: return c, d
        a, b = int(s,3), int(w,3)
        if a>=b:
            k = comb(a,b)%27
            j = multiplicity(3,k)
            d += j*e
            k = k//3**j
            c = c*pow(k,e,27)%27
        else:
            if int(s[0:1],3)<int(w[0:1],3): d += e
            c0, d0 = g1(s[1:],w[1:],e)
            c = c*c0%27
            d += d0
        return c, d
    g = (m:=isqrt(f:=n+1<<1))-(f<=m*(m+1))
    k = n-comb(g+1,2)
    s, w = digits(g,3), digits(k,3)
    if sum(int(d) for d in w)+sum(int(d) for d in digits(g-k,3))-sum(int(d) for d in s)>4: return 0
    s = s.zfill(3)
    w = w.zfill(l:=len(s))
    c, d = g1(s[:3],w[:3],1)
    for i in range(1,l-2):
        c0, d0 = g1(s[i:i+3],w[i:i+3],1)
        c1, d1 = g1(s[i:i+2],w[i:i+2],-1)
        c = c*c0*c1%27
        d += d0+d1
    return c*3**d%27

